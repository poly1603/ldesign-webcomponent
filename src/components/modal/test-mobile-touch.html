<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Modal ç§»åŠ¨ç«¯è§¦æ‘¸æµ‹è¯•</title>
    <script type="module" src="../../dist/ldesign-webcomponent/ldesign-webcomponent.esm.js"></script>
    <link rel="stylesheet" href="../../dist/ldesign-webcomponent/ldesign-webcomponent.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 20px;
        }
        
        .test-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            color: #333;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .test-button:active {
            transform: scale(0.98);
            background: #f0f0f0;
        }
        
        .event-log {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .event-log h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .log-entry {
            padding: 5px;
            margin-bottom: 5px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
        }
        
        .log-entry.success {
            background: #d4edda;
            color: #155724;
        }
        
        .log-entry.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .log-entry.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .info-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 14px;
            color: #666;
        }
        
        .info-row strong {
            color: #333;
        }
        
        /* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ä»¥ä¾¿è°ƒè¯• */
        .debug-button {
            position: relative;
            z-index: 9999;
            pointer-events: auto !important;
            touch-action: manipulation !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± Modal ç§»åŠ¨ç«¯è§¦æ‘¸æµ‹è¯•</h1>
        
        <div class="info-card">
            <div class="info-row">
                <strong>è®¾å¤‡ç±»å‹ï¼š</strong>
                <span id="deviceType">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="info-row">
                <strong>è§¦æ‘¸æ”¯æŒï¼š</strong>
                <span id="touchSupport">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="info-row">
                <strong>æŒ‡é’ˆç±»å‹ï¼š</strong>
                <span id="pointerType">æ£€æµ‹ä¸­...</span>
            </div>
        </div>
        
        <button class="test-button" onclick="openSimpleModal()">
            æ‰“å¼€ç®€å•æ¨¡æ€æ¡†ï¼ˆæ— æ‹–æ‹½ï¼‰
        </button>
        
        <button class="test-button" onclick="openDraggableModal()">
            æ‰“å¼€å¯æ‹–æ‹½æ¨¡æ€æ¡†
        </button>
        
        <button class="test-button" onclick="openDebugModal()">
            æ‰“å¼€è°ƒè¯•æ¨¡æ€æ¡†ï¼ˆè¯¦ç»†äº‹ä»¶æ—¥å¿—ï¼‰
        </button>
        
        <button class="test-button" onclick="clearLog()">
            æ¸…é™¤äº‹ä»¶æ—¥å¿—
        </button>
        
        <div class="event-log">
            <h3>äº‹ä»¶æ—¥å¿—</h3>
            <div id="logContainer"></div>
        </div>
    </div>
    
    <!-- ç®€å•æ¨¡æ€æ¡† -->
    <ldesign-modal id="simpleModal" 
                   modal-title="ç®€å•æ¨¡æ€æ¡†" 
                   closable="true">
        <div style="padding: 20px;">
            <p>è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰æ‹–æ‹½åŠŸèƒ½çš„æ¨¡æ€æ¡†ã€‚</p>
            <p>å…³é—­æŒ‰é’®åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
        </div>
    </ldesign-modal>
    
    <!-- å¯æ‹–æ‹½æ¨¡æ€æ¡† -->
    <ldesign-modal id="draggableModal" 
                   modal-title="å¯æ‹–æ‹½æ¨¡æ€æ¡†" 
                   is-draggable="true"
                   closable="true"
                   maximizable="true">
        <div style="padding: 20px;">
            <p>è¿™æ˜¯ä¸€ä¸ªå¯æ‹–æ‹½çš„æ¨¡æ€æ¡†ã€‚</p>
            <p style="margin-top: 10px; color: #666;">
                æµ‹è¯•æ­¥éª¤ï¼š
            </p>
            <ol style="margin: 10px 0; padding-left: 20px; color: #666; line-height: 1.6;">
                <li>å°è¯•æ‹–åŠ¨æ ‡é¢˜æ </li>
                <li>ç‚¹å‡»å…³é—­æŒ‰é’®</li>
                <li>ç‚¹å‡»æœ€å¤§åŒ–æŒ‰é’®</li>
            </ol>
        </div>
    </ldesign-modal>
    
    <!-- è°ƒè¯•æ¨¡æ€æ¡† -->
    <ldesign-modal id="debugModal" 
                   modal-title="è°ƒè¯•æ¨¡æ€æ¡†" 
                   is-draggable="true"
                   closable="true"
                   maximizable="true">
        <div style="padding: 20px;">
            <p>è¿™ä¸ªæ¨¡æ€æ¡†ä¼šè®°å½•æ‰€æœ‰è§¦æ‘¸å’Œç‚¹å‡»äº‹ä»¶ã€‚</p>
            <button onclick="testButtonInModal()" style="
                padding: 10px 20px;
                background: #667eea;
                color: white;
                border: none;
                border-radius: 6px;
                margin-top: 10px;
                cursor: pointer;
            ">æµ‹è¯•å†…éƒ¨æŒ‰é’®</button>
        </div>
    </ldesign-modal>
    
    <script>
        // äº‹ä»¶æ—¥å¿—ç³»ç»Ÿ
        const eventLog = [];
        let logId = 0;
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = {
                id: ++logId,
                time: timestamp,
                message: message,
                type: type
            };
            eventLog.unshift(entry);
            if (eventLog.length > 50) {
                eventLog.pop();
            }
            updateLogDisplay();
        }
        
        function updateLogDisplay() {
            const container = document.getElementById('logContainer');
            container.innerHTML = eventLog.map(entry => 
                `<div class="log-entry ${entry.type}">
                    [${entry.time}] ${entry.message}
                </div>`
            ).join('');
        }
        
        function clearLog() {
            eventLog.length = 0;
            logId = 0;
            updateLogDisplay();
            addLog('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }
        
        // è®¾å¤‡æ£€æµ‹
        function detectDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const pointerCoarse = window.matchMedia('(pointer: coarse)').matches;
            
            document.getElementById('deviceType').textContent = isMobile ? 'ç§»åŠ¨è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡';
            document.getElementById('touchSupport').textContent = hasTouch ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
            document.getElementById('pointerType').textContent = pointerCoarse ? 'è§¦æ‘¸' : 'é¼ æ ‡';
            
            addLog(`è®¾å¤‡æ£€æµ‹: ${isMobile ? 'ç§»åŠ¨' : 'æ¡Œé¢'}, è§¦æ‘¸: ${hasTouch ? 'æ˜¯' : 'å¦'}`, 'info');
        }
        
        // æ‰“å¼€æ¨¡æ€æ¡†
        function openSimpleModal() {
            addLog('æ‰“å¼€ç®€å•æ¨¡æ€æ¡†', 'info');
            document.getElementById('simpleModal').visible = true;
        }
        
        function openDraggableModal() {
            addLog('æ‰“å¼€å¯æ‹–æ‹½æ¨¡æ€æ¡†', 'warning');
            document.getElementById('draggableModal').visible = true;
        }
        
        function openDebugModal() {
            addLog('æ‰“å¼€è°ƒè¯•æ¨¡æ€æ¡†', 'warning');
            const modal = document.getElementById('debugModal');
            modal.visible = true;
            
            // ä¸ºè°ƒè¯•æ¨¡æ€æ¡†æ·»åŠ è¯¦ç»†çš„äº‹ä»¶ç›‘å¬
            setTimeout(() => {
                const header = modal.querySelector('.ldesign-modal__header');
                const closeBtn = modal.querySelector('.ldesign-modal__close');
                const maxBtn = modal.querySelector('.ldesign-modal__maximize');
                
                if (header) {
                    // ç›‘å¬æ ‡é¢˜æ çš„å„ç§äº‹ä»¶
                    ['touchstart', 'touchend', 'mousedown', 'mouseup', 'click'].forEach(eventType => {
                        header.addEventListener(eventType, (e) => {
                            const target = e.target;
                            const targetName = target.classList ? Array.from(target.classList).join('.') : target.tagName;
                            addLog(`Header ${eventType} on ${targetName}`, 'info');
                        }, { capture: true, passive: true });
                    });
                }
                
                if (closeBtn) {
                    // ç›‘å¬å…³é—­æŒ‰é’®çš„å„ç§äº‹ä»¶
                    ['touchstart', 'touchend', 'mousedown', 'mouseup', 'click'].forEach(eventType => {
                        closeBtn.addEventListener(eventType, (e) => {
                            addLog(`Close button ${eventType}`, 'success');
                            if (eventType === 'click' || eventType === 'touchend') {
                                addLog('å…³é—­æŒ‰é’®è¢«æ¿€æ´»ï¼', 'success');
                            }
                        }, { capture: true });
                    });
                    
                    // æ·»åŠ è°ƒè¯•ç±»
                    closeBtn.classList.add('debug-button');
                    closeBtn.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
                }
                
                if (maxBtn) {
                    // ç›‘å¬æœ€å¤§åŒ–æŒ‰é’®çš„å„ç§äº‹ä»¶
                    ['touchstart', 'touchend', 'mousedown', 'mouseup', 'click'].forEach(eventType => {
                        maxBtn.addEventListener(eventType, (e) => {
                            addLog(`Maximize button ${eventType}`, 'success');
                        }, { capture: true });
                    });
                    
                    maxBtn.classList.add('debug-button');
                    maxBtn.style.backgroundColor = 'rgba(0, 255, 0, 0.1)';
                }
            }, 100);
        }
        
        function testButtonInModal() {
            addLog('å†…éƒ¨æŒ‰é’®è¢«ç‚¹å‡»', 'success');
            alert('æŒ‰é’®ç‚¹å‡»æˆåŠŸï¼');
        }
        
        // ç›‘å¬æ‰€æœ‰æ¨¡æ€æ¡†äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            detectDevice();
            
            // ç›‘å¬æ¨¡æ€æ¡†äº‹ä»¶
            document.querySelectorAll('ldesign-modal').forEach(modal => {
                modal.addEventListener('ldesignVisibleChange', (e) => {
                    addLog(`Modal ${modal.id} visible: ${e.detail}`, e.detail ? 'warning' : 'info');
                });
                
                modal.addEventListener('ldesignClose', () => {
                    addLog(`Modal ${modal.id} å…³é—­äº‹ä»¶è§¦å‘`, 'success');
                });
            });
            
            // å…¨å±€è§¦æ‘¸äº‹ä»¶ç›‘å¬ï¼ˆç”¨äºè°ƒè¯•ï¼‰
            document.addEventListener('touchstart', (e) => {
                const target = e.target;
                const targetDesc = target.id || target.className || target.tagName;
                console.log('Global touchstart:', targetDesc, e);
            }, { capture: true });
            
            document.addEventListener('touchend', (e) => {
                const target = e.target;
                const targetDesc = target.id || target.className || target.tagName;
                console.log('Global touchend:', targetDesc, e);
            }, { capture: true });
            
            // æ£€æµ‹ç‚¹å‡»äº‹ä»¶æ˜¯å¦è¢«è§¦å‘
            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.closest('.ldesign-modal__close')) {
                    addLog('æ£€æµ‹åˆ°å…³é—­æŒ‰é’®çš„ click äº‹ä»¶ï¼', 'success');
                }
                if (target.closest('.ldesign-modal__maximize')) {
                    addLog('æ£€æµ‹åˆ°æœ€å¤§åŒ–æŒ‰é’®çš„ click äº‹ä»¶ï¼', 'success');
                }
            }, { capture: true });
        });
        
        // æ·»åŠ è°ƒè¯•ä¿¡æ¯
        addLog('æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
    </script>
</body>
</html>