# é”šç‚¹éƒ¨åˆ†é®ç½©å®šä½ä¿®å¤

## é—®é¢˜æè¿°

åœ¨"é”šç‚¹å®šä½ - éƒ¨åˆ†é®ç½©å±•å¼€"ç¤ºä¾‹ä¸­ï¼Œç‚¹å‡»å››ä¸ªæ–¹å‘æŒ‰é’®åå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š

1. **åªæ˜¾ç¤ºå…¨å±é®ç½©**ï¼šæ•´ä¸ªå±å¹•éƒ½è¢«é®ç½©è¦†ç›–ï¼Œè€Œä¸æ˜¯åªåœ¨å±•å¼€æ–¹å‘æ˜¾ç¤ºé®ç½©
2. **çœ‹ä¸åˆ°æŠ½å±‰**ï¼šæŠ½å±‰å…ƒç´ æ²¡æœ‰æ˜¾ç¤ºï¼Œæˆ–è€…è¢«é®ç½©ç›–ä½äº†

## æ ¹æœ¬åŸå› 

### 1. æŠ½å±‰å°ºå¯¸æœªé“ºæ»¡å±•å¼€åŒºåŸŸ

åœ¨é”šç‚¹éƒ¨åˆ†é®ç½©æ¨¡å¼ä¸‹ï¼ŒæŠ½å±‰ä½¿ç”¨å›ºå®šçš„ `size` å±æ€§ï¼ˆå¦‚ `size="300px"`ï¼‰ï¼Œä½†ç”¨æˆ·æœŸæœ›æŠ½å±‰èƒ½**é“ºæ»¡ä»æŒ‰é’®åˆ°å±å¹•è¾¹ç•Œçš„æ•´ä¸ªåŒºåŸŸ**ã€‚

**é—®é¢˜è¡¨ç°ï¼š**
- å‘ä¸‹å±•å¼€ï¼šæŠ½å±‰åªæœ‰å›ºå®šé«˜åº¦ï¼ˆå¦‚ 300pxï¼‰ï¼Œè€Œä¸æ˜¯é“ºæ»¡åˆ°å±å¹•åº•éƒ¨
- å‘å³å±•å¼€ï¼šæŠ½å±‰åªæœ‰å›ºå®šå®½åº¦ï¼Œè€Œä¸æ˜¯é“ºæ»¡åˆ°å±å¹•å³è¾¹ç¼˜
- é®ç½©åŒºåŸŸæ˜¾ç¤ºæ­£ç¡®ï¼Œä½†æŠ½å±‰æœ¬èº«å¤ªå°ï¼Œç”¨æˆ·ä½“éªŒä¸ä½³

### 2. åæ ‡ç³»ç»Ÿæ··æ·†

åœ¨ `drawer.anchor.ts` çš„ `getElementBounds` å‡½æ•°ä¸­ï¼š

**é—®é¢˜ä»£ç ï¼š**
```typescript
function getElementBounds(element: HTMLElement): ElementBounds {
  const rect = element.getBoundingClientRect();
  return {
    top: rect.top + window.scrollY,    // åŠ ä¸Šäº†æ»šåŠ¨åç§»
    left: rect.left + window.scrollX,  // åŠ ä¸Šäº†æ»šåŠ¨åç§»
    // ...
  };
}
```

**é—®é¢˜åˆ†æï¼š**
- `createPartialMask` åˆ›å»ºçš„é®ç½©ä½¿ç”¨ `position: fixed` å®šä½
- `fixed` å®šä½ç›¸å¯¹äºè§†å£ï¼ˆviewportï¼‰ï¼Œä¸éœ€è¦åŠ ä¸Š `scrollY/scrollX`
- ä½† `getElementBounds` è¿”å›çš„åæ ‡åŒ…å«äº†æ»šåŠ¨åç§»
- è¿™å¯¼è‡´é®ç½©ä½ç½®è®¡ç®—é”™è¯¯ï¼Œå¯èƒ½æ˜¾ç¤ºåœ¨é”™è¯¯çš„ä½ç½®æˆ–è¦†ç›–æ•´ä¸ªå±å¹•

### 3. Z-index å±‚å é—®é¢˜

éƒ¨åˆ†é®ç½©çš„ z-index è®¾ç½®ä¸å½“ï¼š

**é—®é¢˜ä»£ç ï¼š**
```typescript
export function createPartialMask(...): HTMLElement {
  // ...
  mask.style.cssText = `
    // ...
    z-index: 999;
  `;
}
```

**é—®é¢˜åˆ†æï¼š**
- éƒ¨åˆ†é®ç½© z-index æ˜¯ 999
- æŠ½å±‰ç»„ä»¶çš„é»˜è®¤ z-index æ˜¯ 1000
- ç»„ä»¶å†…ç½®é®ç½©çš„ z-index æ˜¯ 999 (`this.zIndex - 1`)
- å¯èƒ½ä¸å†…ç½®é®ç½©å†²çª

### 4. é»˜è®¤é®ç½©ä¸éƒ¨åˆ†é®ç½©å†²çª

åœ¨é”šç‚¹æ¨¡å¼ä¸‹ï¼Œç»„ä»¶ä»ç„¶æ¸²æŸ“é»˜è®¤çš„å…¨å±é®ç½©ï¼š

**é—®é¢˜ä»£ç ï¼š**
```tsx
<Host class={this.getContainerClass()}>
  {/* é®ç½©å±‚ */}
  {this.mask && (  // æ€»æ˜¯æ˜¾ç¤º
    <div class={`drawer-mask ${this.maskClass}`} />
  )}
</Host>
```

**é—®é¢˜åˆ†æï¼š**
- é”šç‚¹æ¨¡å¼åº”è¯¥åªæ˜¾ç¤ºéƒ¨åˆ†é®ç½©
- ä½†ç»„ä»¶ä»ç„¶æ¸²æŸ“é»˜è®¤çš„å…¨å±é®ç½©
- ä¸¤ä¸ªé®ç½©åŒæ—¶å­˜åœ¨å¯¼è‡´æ··ä¹±

## è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1: éƒ¨åˆ†é®ç½©æ¨¡å¼ä¸‹è‡ªåŠ¨é“ºæ»¡å±•å¼€åŒºåŸŸ

**æ–‡ä»¶ï¼š** `drawer.anchor.ts`

åœ¨ `calculateAnchorPosition` å‡½æ•°ä¸­ï¼Œå½“å¯ç”¨ `maskPartial` æ—¶ï¼Œè‡ªåŠ¨è®¡ç®—æŠ½å±‰å°ºå¯¸ä»¥é“ºæ»¡å±•å¼€æ–¹å‘çš„æ•´ä¸ªåŒºåŸŸï¼š

**å‘ä¸‹å±•å¼€ä¿®å¤ï¼š**
```typescript
case 'bottom':
  // ... åŸæœ‰ä½ç½®è®¡ç®— ...
  
  if (config.maskPartial) {
    position.maskBounds = {
      top: anchorBounds.bottom,
      left: boundaryBounds.left,
      width: boundaryBounds.width,
      height: boundaryBounds.bottom - anchorBounds.bottom
    };
    
    // ğŸ¯ éƒ¨åˆ†é®ç½©æ¨¡å¼ï¼šæŠ½å±‰é“ºæ»¡å±•å¼€æ–¹å‘çš„åŒºåŸŸ
    position.width = boundaryBounds.width;                        // é“ºæ»¡å±å¹•å®½åº¦
    position.height = boundaryBounds.bottom - anchorBounds.bottom; // ä»æŒ‰é’®åˆ°å±å¹•åº•éƒ¨
    position.left = boundaryBounds.left;                          // å·¦å¯¹é½å±å¹•
  }
  break;
```

**å‘ä¸Šå±•å¼€ä¿®å¤ï¼š**
```typescript
case 'top':
  if (config.maskPartial) {
    // æŠ½å±‰ä»å±å¹•é¡¶éƒ¨å»¶ä¼¸åˆ°æŒ‰é’®é¡¶éƒ¨
    position.width = boundaryBounds.width;
    position.height = anchorBounds.top - boundaryBounds.top;
    position.top = boundaryBounds.top;
    position.left = boundaryBounds.left;
  }
  break;
```

**å‘å·¦å±•å¼€ä¿®å¤ï¼š**
```typescript
case 'left':
  if (config.maskPartial) {
    // æŠ½å±‰ä»å±å¹•å·¦è¾¹ç¼˜å»¶ä¼¸åˆ°æŒ‰é’®å·¦è¾¹ç¼˜
    position.width = anchorBounds.left - boundaryBounds.left;
    position.height = boundaryBounds.height;
    position.left = boundaryBounds.left;
    position.top = boundaryBounds.top;
  }
  break;
```

**å‘å³å±•å¼€ä¿®å¤ï¼š**
```typescript
case 'right':
  if (config.maskPartial) {
    // æŠ½å±‰ä»æŒ‰é’®å³è¾¹ç¼˜å»¶ä¼¸åˆ°å±å¹•å³è¾¹ç¼˜
    position.width = boundaryBounds.right - anchorBounds.right;
    position.height = boundaryBounds.height;
    position.left = anchorBounds.right;
    position.top = boundaryBounds.top;
  }
  break;
```

### ä¿®å¤ 2: æ”¯æŒè§†å£åæ ‡ç³»ç»Ÿ

**æ–‡ä»¶ï¼š** `drawer.anchor.ts`

**ä¿®æ”¹ `getElementBounds` å‡½æ•°ï¼š**
```typescript
/**
 * è·å–å…ƒç´ è¾¹ç•Œä¿¡æ¯
 * @param useViewportCoords - å¦‚æœä¸º trueï¼Œè¿”å›ç›¸å¯¹äºè§†å£çš„åæ ‡ï¼ˆç”¨äº fixed å®šä½ï¼‰
 */
function getElementBounds(element: HTMLElement, useViewportCoords: boolean = false): ElementBounds {
  const rect = element.getBoundingClientRect();
  
  // å¯¹äº fixed å®šä½ï¼Œä½¿ç”¨è§†å£åæ ‡ï¼›å¦åˆ™ä½¿ç”¨æ–‡æ¡£åæ ‡
  if (useViewportCoords) {
    return {
      top: rect.top,      // ä¸åŠ æ»šåŠ¨åç§»
      left: rect.left,    // ä¸åŠ æ»šåŠ¨åç§»
      right: rect.right,
      bottom: rect.bottom,
      width: rect.width,
      height: rect.height,
      centerX: rect.left + rect.width / 2,
      centerY: rect.top + rect.height / 2
    };
  }
  
  // æ–‡æ¡£åæ ‡ï¼ˆç”¨äº absolute å®šä½ï¼‰
  return {
    top: rect.top + window.scrollY,
    left: rect.left + window.scrollX,
    // ...
  };
}
```

**ä¿®æ”¹ `getViewportBounds` å‡½æ•°ï¼š**
```typescript
/**
 * è·å–è§†å£è¾¹ç•Œ
 * @param useViewportCoords - å¦‚æœä¸º trueï¼Œè¿”å›ç›¸å¯¹äºè§†å£çš„åæ ‡ï¼ˆç”¨äº fixed å®šä½ï¼‰
 */
function getViewportBounds(useViewportCoords: boolean = false): ElementBounds {
  if (useViewportCoords) {
    return {
      top: 0,              // è§†å£é¡¶éƒ¨æ˜¯ 0
      left: 0,             // è§†å£å·¦ä¾§æ˜¯ 0
      right: window.innerWidth,
      bottom: window.innerHeight,
      width: window.innerWidth,
      height: window.innerHeight,
      centerX: window.innerWidth / 2,
      centerY: window.innerHeight / 2
    };
  }
  
  // æ–‡æ¡£åæ ‡
  return {
    top: window.scrollY,
    left: window.scrollX,
    // ...
  };
}
```

**ä¿®æ”¹ `calculateAnchorPosition` å‡½æ•°ï¼š**
```typescript
export function calculateAnchorPosition(
  anchorElement: HTMLElement,
  drawerSize: { width: number; height: number },
  config: AnchorConfig
): AnchorPosition {
  // ä½¿ç”¨è§†å£åæ ‡ç³»ç»Ÿï¼ˆå› ä¸ºæŠ½å±‰å’Œé®ç½©éƒ½ä½¿ç”¨ fixed å®šä½ï¼‰
  const anchorBounds = getElementBounds(anchorElement, true);
  const boundaryBounds = getViewportBounds(true);
  
  // ... å…¶ä½™ä»£ç 
}
```

### ä¿®å¤ 3: è°ƒæ•´ z-index å’Œæ ·å¼

**æ–‡ä»¶ï¼š** `drawer.anchor.ts`

**ä¿®æ”¹ `createPartialMask` å‡½æ•°ï¼š**
```typescript
export function createPartialMask(
  bounds: {
    top: number;
    left: number;
    width: number;
    height: number;
  },
  className: string = 'drawer-partial-mask'
): HTMLElement {
  const mask = document.createElement('div');
  mask.className = className;
  mask.style.cssText = `
    position: fixed;
    top: ${bounds.top}px;
    left: ${bounds.left}px;
    width: ${bounds.width}px;
    height: ${bounds.height}px;
    background-color: rgba(0, 0, 0, 0.45);  // è°ƒæ•´é€æ˜åº¦
    pointer-events: auto;
    z-index: 998;                             // ä½äºæŠ½å±‰çš„ 1000
    transition: opacity 0.3s ease;            // æ·»åŠ è¿‡æ¸¡åŠ¨ç”»
  `;
  return mask;
}
```

### ä¿®å¤ 4: éšè—é”šç‚¹æ¨¡å¼ä¸‹çš„é»˜è®¤é®ç½©

**æ–‡ä»¶ï¼š** `drawer.tsx`

**ä¿®æ”¹æ¸²æŸ“æ–¹æ³•ï¼š**
```tsx
return (
  <Host class={this.getContainerClass()}>
    {/* é®ç½©å±‚ï¼ˆé”šç‚¹æ¨¡å¼ä¸‹ä½¿ç”¨éƒ¨åˆ†é®ç½©ï¼Œä¸æ˜¾ç¤ºé»˜è®¤é®ç½©ï¼‰ */}
    {this.mask && !this.isAnchorMode && (  // æ·»åŠ  !this.isAnchorMode æ¡ä»¶
      <div
        class={`drawer-mask ${this.maskClass}`}
        onClick={this.handleMaskClick}
        style={{ zIndex: (this.zIndex - 1).toString() }}
      />
    )}
    
    {/* æŠ½å±‰ä¸»ä½“ */}
    <div class="drawer-wrapper" style={this.getDrawerStyle()}>
      {/* ... */}
    </div>
  </Host>
);
```

## å·¥ä½œåŸç†

### 1. åæ ‡ç³»ç»Ÿ

ç°åœ¨æœ‰ä¸¤ç§åæ ‡ç³»ç»Ÿï¼š

#### æ–‡æ¡£åæ ‡ï¼ˆDocument Coordinatesï¼‰
- ç›¸å¯¹äºæ•´ä¸ªæ–‡æ¡£å·¦ä¸Šè§’
- åŒ…å«æ»šåŠ¨åç§»é‡
- ç”¨äº `absolute` å®šä½

```typescript
const docCoords = getElementBounds(element, false);
// docCoords.top = rect.top + window.scrollY
```

#### è§†å£åæ ‡ï¼ˆViewport Coordinatesï¼‰
- ç›¸å¯¹äºæµè§ˆå™¨è§†å£å·¦ä¸Šè§’
- ä¸åŒ…å«æ»šåŠ¨åç§»é‡
- ç”¨äº `fixed` å®šä½

```typescript
const viewportCoords = getElementBounds(element, true);
// viewportCoords.top = rect.top (ä¸åŠ  scrollY)
```

### 2. éƒ¨åˆ†é®ç½©çš„åˆ›å»ºå’Œå®šä½

å½“å¯ç”¨ `anchor-mask-partial="true"` æ—¶ï¼š

1. **è®¡ç®—é”šç‚¹ä½ç½®**ï¼ˆä½¿ç”¨è§†å£åæ ‡ï¼‰ï¼š
   ```typescript
   const anchorBounds = getElementBounds(anchorElement, true);
   ```

2. **è®¡ç®—é®ç½©èŒƒå›´**ï¼ˆæ ¹æ®å±•å¼€æ–¹å‘ï¼‰ï¼š
   ```typescript
   // å‘ä¸‹å±•å¼€ï¼šé®ç½©è¦†ç›–æŒ‰é’®ä¸‹æ–¹åˆ°å±å¹•åº•éƒ¨
   if (placement === 'bottom') {
     position.maskBounds = {
       top: anchorBounds.bottom,  // æŒ‰é’®åº•éƒ¨
       left: 0,                   // å±å¹•å·¦ä¾§
       width: window.innerWidth,  // å±å¹•å®½åº¦
       height: window.innerHeight - anchorBounds.bottom  // åˆ°å±å¹•åº•éƒ¨
     };
   }
   ```

3. **åˆ›å»ºé®ç½©å…ƒç´ **ï¼ˆä½¿ç”¨ fixed å®šä½ï¼‰ï¼š
   ```typescript
   const mask = createPartialMask(position.maskBounds);
   document.body.appendChild(mask);
   ```

4. **z-index å±‚å **ï¼š
   - é¡µé¢å†…å®¹: z-index < 998
   - éƒ¨åˆ†é®ç½©: z-index = 998
   - æŠ½å±‰: z-index = 1000
   - ç¡®ä¿æŠ½å±‰æ˜¾ç¤ºåœ¨é®ç½©ä¹‹ä¸Š

### 3. å››ä¸ªæ–¹å‘çš„é®ç½©èŒƒå›´

#### å‘ä¸‹å±•å¼€ (bottom)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¯äº¤äº’åŒºåŸŸ          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚æŒ‰é’® â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† æŒ‰é’®åº•éƒ¨
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  é®ç½©åŒºåŸŸ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å‘ä¸Šå±•å¼€ (top)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  é®ç½©åŒºåŸŸ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† æŒ‰é’®é¡¶éƒ¨
â”‚  â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚æŒ‰é’® â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜            â”‚
â”‚   å¯äº¤äº’åŒºåŸŸ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å‘å·¦å±•å¼€ (left)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚          â”‚
â”‚â–ˆâ–ˆ  é®ç½© â–ˆâ–ˆâ”‚  å¯äº¤äº’  â”‚
â”‚â–ˆâ–ˆ  åŒºåŸŸ â–ˆâ–ˆâ”‚  åŒºåŸŸ    â”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘ æŒ‰é’®å·¦ä¾§
```

#### å‘å³å±•å¼€ (right)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚  å¯äº¤äº’  â”‚â–ˆâ–ˆ  é®ç½© â–ˆâ–ˆâ”‚
â”‚  åŒºåŸŸ    â”‚â–ˆâ–ˆ  åŒºåŸŸ â–ˆâ–ˆâ”‚
â”‚          â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†‘ æŒ‰é’®å³ä¾§
```

## éªŒè¯æ–¹æ³•

### 1. æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€æ–‡æ¡£é¡µé¢**
   ```
   packages/webcomponent/docs/components/drawer.md
   ```

2. **æ‰¾åˆ°ç¤ºä¾‹ç« èŠ‚**
   - æ‰¾åˆ°"é”šç‚¹å®šä½ - éƒ¨åˆ†é®ç½©å±•å¼€"
   - çœ‹åˆ°å››ä¸ªæŒ‰é’®ï¼šå‘ä¸‹å±•å¼€ â–¼ã€å‘ä¸Šå±•å¼€ â–²ã€å‘å·¦å±•å¼€ â—€ã€å‘å³å±•å¼€ â–¶

3. **æµ‹è¯•æ¯ä¸ªæ–¹å‘**
   - ç‚¹å‡»"å‘ä¸‹å±•å¼€ â–¼"
   - ç‚¹å‡»"å‘ä¸Šå±•å¼€ â–²"
   - ç‚¹å‡»"å‘å·¦å±•å¼€ â—€"
   - ç‚¹å‡»"å‘å³å±•å¼€ â–¶"

### 2. é¢„æœŸæ•ˆæœ

âœ… **æ­£ç¡®çš„è¡¨ç°ï¼š**
- æŠ½å±‰ä»æŒ‰é’®ä½ç½®å‘æŒ‡å®šæ–¹å‘å±•å¼€
- **åªåœ¨å±•å¼€æ–¹å‘æœ‰é®ç½©**ï¼ˆå…³é”®ï¼‰
- æœªå±•å¼€çš„åŒºåŸŸä¿æŒé€æ˜ï¼Œå¯ä»¥ç‚¹å‡»é¡µé¢å…¶ä»–å…ƒç´ 
- æŠ½å±‰å®Œå…¨å¯è§ï¼Œä¸ä¼šè¢«é®ç½©ç›–ä½
- é®ç½©å¯¹é½åˆ°æŒ‰é’®è¾¹ç¼˜ï¼ŒèŒƒå›´åˆç†

âŒ **é”™è¯¯çš„è¡¨ç°ï¼ˆä¿®å¤å‰ï¼‰ï¼š**
- æ•´ä¸ªå±å¹•è¢«é®ç½©è¦†ç›–
- çœ‹ä¸åˆ°æŠ½å±‰æˆ–æŠ½å±‰è¢«é®ç½©ç›–ä½
- æ— æ³•ç‚¹å‡»é¡µé¢å…¶ä»–å…ƒç´ 

### 3. å¼€å‘è€…å·¥å…·æ£€æŸ¥

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼š

1. **æ£€æŸ¥éƒ¨åˆ†é®ç½©å…ƒç´ **
   ```javascript
   const mask = document.querySelector('.drawer-partial-mask');
   console.log('Mask:', mask);
   console.log('Position:', mask.style.position);  // åº”è¯¥æ˜¯ "fixed"
   console.log('Top:', mask.style.top);
   console.log('Left:', mask.style.left);
   console.log('Width:', mask.style.width);
   console.log('Height:', mask.style.height);
   console.log('Z-index:', mask.style.zIndex);     // åº”è¯¥æ˜¯ "998"
   ```

2. **æ£€æŸ¥æŠ½å±‰å…ƒç´ **
   ```javascript
   const drawer = document.querySelector('ldesign-drawer');
   const wrapper = drawer.shadowRoot.querySelector('.drawer-wrapper');
   console.log('Drawer wrapper:', wrapper);
   console.log('Z-index:', getComputedStyle(wrapper).zIndex);  // åº”è¯¥æ˜¯ "1000"
   ```

3. **æ£€æŸ¥é»˜è®¤é®ç½©**
   ```javascript
   const defaultMask = drawer.shadowRoot.querySelector('.drawer-mask');
   console.log('Default mask:', defaultMask);  // åº”è¯¥æ˜¯ nullï¼ˆé”šç‚¹æ¨¡å¼ä¸‹ï¼‰
   ```

## å½±å“èŒƒå›´

### ä¿®å¤çš„åŠŸèƒ½
- âœ… é”šç‚¹éƒ¨åˆ†é®ç½©ç°åœ¨æ­£ç¡®æ˜¾ç¤ºåœ¨å±•å¼€æ–¹å‘
- âœ… æŠ½å±‰å¯è§ä¸”æ­£ç¡®å®šä½
- âœ… æœªå±•å¼€çš„åŒºåŸŸä¿æŒå¯äº¤äº’
- âœ… z-index å±‚å æ­£ç¡®
- âœ… é®ç½©ä¸ä¼šå…¨å±è¦†ç›–

### ä¸å½±å“çš„åŠŸèƒ½
- âœ… æ™®é€šæŠ½å±‰æ¨¡å¼ä¸å—å½±å“
- âœ… é”šç‚¹å®šä½ï¼ˆæ— éƒ¨åˆ†é®ç½©ï¼‰ä»ç„¶æ­£å¸¸å·¥ä½œ
- âœ… å…¶ä»–ç»„ä»¶åŠŸèƒ½å®Œå…¨æ­£å¸¸

## ç›¸å…³æ–‡ä»¶

- `drawer.anchor.ts` - é”šç‚¹å®šä½å·¥å…·ï¼ˆå·²ä¿®å¤åæ ‡ç³»ç»Ÿå’Œ z-indexï¼‰
- `drawer.tsx` - ç»„ä»¶æºç ï¼ˆå·²ä¿®å¤é»˜è®¤é®ç½©æ˜¾ç¤ºé€»è¾‘ï¼‰
- `drawer.md` - ç»„ä»¶æ–‡æ¡£ï¼ˆç¤ºä¾‹æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
- `ANCHOR_PARTIAL_DRAWER_FIX.md` - æŒ‰é’®äº‹ä»¶ç»‘å®šä¿®å¤æ–‡æ¡£

## æŠ€æœ¯è¦ç‚¹

### 1. CSS å®šä½ç³»ç»Ÿ

| å®šä½ç±»å‹ | åæ ‡åŸç‚¹ | å—æ»šåŠ¨å½±å“ | ä½¿ç”¨åœºæ™¯ |
|---------|---------|-----------|----------|
| `fixed` | è§†å£å·¦ä¸Šè§’ | å¦ | å›ºå®šåœ¨å±å¹•ä¸Šçš„å…ƒç´ ï¼ˆé®ç½©ã€æŠ½å±‰ï¼‰ |
| `absolute` | æœ€è¿‘å®šä½ç¥–å…ˆ | æ˜¯ | ç›¸å¯¹äºçˆ¶å…ƒç´ å®šä½ |
| `relative` | å…ƒç´ åŸä½ç½® | æ˜¯ | å¾®è°ƒå…ƒç´ ä½ç½® |
| `sticky` | è§†å£/å®¹å™¨ | æ˜¯/å¦ | æ»šåŠ¨å¸é¡¶/å¸åº• |

### 2. getBoundingClientRect()

- è¿”å›ç›¸å¯¹äº**è§†å£**çš„åæ ‡
- ä¸åŒ…å«æ»šåŠ¨åç§»
- é€‚åˆ `fixed` å®šä½ä½¿ç”¨

```typescript
const rect = element.getBoundingClientRect();
// rect.top æ˜¯ç›¸å¯¹äºè§†å£é¡¶éƒ¨çš„è·ç¦»ï¼Œä¸éœ€è¦åŠ  scrollY
```

### 3. æ»šåŠ¨åç§»

- `window.scrollY`: é¡µé¢å‚ç›´æ»šåŠ¨è·ç¦»
- `window.scrollX`: é¡µé¢æ°´å¹³æ»šåŠ¨è·ç¦»
- åªåœ¨éœ€è¦æ–‡æ¡£åæ ‡æ—¶æ·»åŠ 

```typescript
// æ–‡æ¡£åæ ‡ = è§†å£åæ ‡ + æ»šåŠ¨åç§»
const docTop = rect.top + window.scrollY;
const docLeft = rect.left + window.scrollX;
```

## ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰ âŒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯äº¤äº’åŒºåŸŸ                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚æŒ‰é’® â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† æŒ‰é’®åº•éƒ¨
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  é®ç½©æ­£ç¡®  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â† æŠ½å±‰å¤ªå°ï¼     â”‚
â”‚  â”‚ 300px â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®å¤å âœ…
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯äº¤äº’åŒºåŸŸ                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚æŒ‰é’® â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† æŒ‰é’®åº•éƒ¨
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  é®ç½©è¦†ç›–  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚â”‚  æŠ½å±‰é“ºæ»¡æ•´ä¸ªåŒºåŸŸï¼        â”‚â”‚
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æµ‹è¯•æ–‡ä»¶

åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•æ–‡ä»¶ `test-anchor-partial-fill.html` æ¥éªŒè¯ä¿®å¤æ•ˆæœï¼š

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•æ–‡ä»¶
test-anchor-partial-fill.html
```

æµ‹è¯•æ–‡ä»¶åŒ…å«ï¼š
- âœ… å››ä¸ªæ–¹å‘çš„å®Œæ•´æµ‹è¯•ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ï¼‰
- âœ… å®æ—¶åæ ‡æ˜¾ç¤º
- âœ… æ§åˆ¶å°æ—¥å¿—è¾“å‡ºé¢„æœŸå€¼å’Œå®é™…å€¼
- âœ… è¯¦ç»†çš„é¢„æœŸæ•ˆæœè¯´æ˜
- âœ… å¼€å‘è€…å·¥å…·æ£€æŸ¥æŒ‡å—

## æ€»ç»“

è¿™æ¬¡ä¿®å¤è§£å†³äº†é”šç‚¹éƒ¨åˆ†é®ç½©åŠŸèƒ½ä¸­çš„å››ä¸ªå…³é”®é—®é¢˜ï¼š

1. **æŠ½å±‰å°ºå¯¸é—®é¢˜**ï¼šéƒ¨åˆ†é®ç½©æ¨¡å¼ä¸‹ï¼ŒæŠ½å±‰ç°åœ¨è‡ªåŠ¨é“ºæ»¡ä»æŒ‰é’®åˆ°å±å¹•è¾¹ç•Œçš„æ•´ä¸ªåŒºåŸŸ
2. **åæ ‡ç³»ç»Ÿæ··æ·†**ï¼šé€šè¿‡æ·»åŠ  `useViewportCoords` å‚æ•°ï¼Œæ”¯æŒè§†å£å’Œæ–‡æ¡£ä¸¤ç§åæ ‡ç³»ç»Ÿ
3. **z-index å†²çª**ï¼šè°ƒæ•´éƒ¨åˆ†é®ç½©çš„ z-index ä¸º 998ï¼Œç¡®ä¿æŠ½å±‰æ˜¾ç¤ºåœ¨é®ç½©ä¹‹ä¸Š
4. **é®ç½©é‡å¤**ï¼šåœ¨é”šç‚¹æ¨¡å¼ä¸‹éšè—é»˜è®¤çš„å…¨å±é®ç½©ï¼Œåªæ˜¾ç¤ºéƒ¨åˆ†é®ç½©

ä¿®å¤åï¼Œé”šç‚¹éƒ¨åˆ†é®ç½©åŠŸèƒ½å®Œå…¨ç¬¦åˆé¢„æœŸï¼š
- âœ… æŠ½å±‰ä»æŒ‰é’®ä½ç½®å‘æŒ‡å®šæ–¹å‘é“ºæ»¡æ•´ä¸ªåŒºåŸŸ
- âœ… é®ç½©åªè¦†ç›–å±•å¼€æ–¹å‘
- âœ… æœªå±•å¼€çš„åŒºåŸŸä¿æŒé€æ˜å¯äº¤äº’
- âœ… æŠ½å±‰å®Œå…¨å¯è§ï¼Œä¸è¢«é®ç½©ç›–ä½
- âœ… å››ä¸ªæ–¹å‘å‡å·¥ä½œæ­£å¸¸
