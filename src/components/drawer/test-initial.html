<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drawer åˆå§‹åŒ–æµ‹è¯•</title>
  <script type="module" src="../../loader/index.ts"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .page-content {
      padding: 40px;
    }

    button {
      padding: 12px 24px;
      font-size: 14px;
      background: #1890ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px;
    }

    button:hover {
      background: #40a9ff;
    }

    .test-section {
      margin-bottom: 40px;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 8px;
    }

    h2 {
      color: #333;
      margin-top: 0;
    }

    .warning {
      padding: 12px;
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .success {
      padding: 12px;
      background: #d4edda;
      border: 1px solid #28a745;
      border-radius: 4px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="page-content">
    <h1>ğŸ§ª Drawer åˆå§‹åŒ–æµ‹è¯•</h1>

    <div class="test-section">
      <h2>æµ‹è¯• 1: åˆå§‹ visible=falseï¼ˆé»˜è®¤ï¼‰</h2>
      <p>âœ… æ­£ç¡®è¡Œä¸ºï¼šé¡µé¢åŠ è½½æ—¶ï¼Œdrawer åº”è¯¥å®Œå…¨éšè—ï¼Œä¸æ˜¾ç¤ºä»»ä½•å†…å®¹</p>
      <p>âŒ é”™è¯¯è¡Œä¸ºï¼šå¦‚æœçœ‹åˆ° drawer å†…å®¹æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè¯´æ˜æœ‰é—®é¢˜</p>
      <button onclick="document.getElementById('drawer-1').open()">æ‰“å¼€ Drawer 1</button>
    </div>

    <div class="test-section">
      <h2>æµ‹è¯• 2: åˆå§‹ visible=true</h2>
      <p>âš ï¸ è¿™ä¸ª drawer åˆå§‹è®¾ç½®äº† visible="true"ï¼Œåº”è¯¥åœ¨é¡µé¢åŠ è½½æ—¶å°±æ‰“å¼€</p>
      <button onclick="document.getElementById('drawer-2').close()">å…³é—­ Drawer 2</button>
    </div>

    <div class="test-section">
      <h2>æµ‹è¯• 3: å¤šä¸ª Drawerï¼ˆéƒ½æ˜¯ visible=falseï¼‰</h2>
      <button onclick="document.getElementById('drawer-3').open()">æ‰“å¼€å·¦ä¾§</button>
      <button onclick="document.getElementById('drawer-4').open()">æ‰“å¼€å³ä¾§</button>
      <button onclick="document.getElementById('drawer-5').open()">æ‰“å¼€é¡¶éƒ¨</button>
      <button onclick="document.getElementById('drawer-6').open()">æ‰“å¼€åº•éƒ¨</button>
    </div>

    <div id="status" class="warning" style="display: none;">
      <strong>âš ï¸ æ£€æµ‹åˆ°é—®é¢˜ï¼š</strong> 
      é¡µé¢ä¸Šå¯èƒ½æ˜¾ç¤ºäº†ä¸åº”è¯¥æ˜¾ç¤ºçš„ drawer å†…å®¹ï¼
    </div>
  </div>

  <!-- æµ‹è¯• 1: é»˜è®¤ visible=false -->
  <ldesign-drawer 
    id="drawer-1" 
    placement="right" 
    drawerTitle="æµ‹è¯• Drawer 1">
    <div style="padding: 20px;">
      <h3>è¿™æ˜¯ Drawer 1 çš„å†…å®¹</h3>
      <p>å¦‚æœåœ¨é¡µé¢åˆå§‹åŠ è½½æ—¶å°±èƒ½çœ‹åˆ°è¿™æ®µæ–‡å­—ï¼Œè¯´æ˜æœ‰é—®é¢˜ï¼</p>
      <p>Drawer åº”è¯¥å®Œå…¨éšè—ï¼Œåªæœ‰ç‚¹å‡»"æ‰“å¼€"æŒ‰é’®æ‰åº”è¯¥æ˜¾ç¤ºã€‚</p>
    </div>
  </ldesign-drawer>

  <!-- æµ‹è¯• 2: åˆå§‹ visible=true -->
  <ldesign-drawer 
    id="drawer-2" 
    placement="right" 
    drawerTitle="æµ‹è¯• Drawer 2ï¼ˆåˆå§‹æ‰“å¼€ï¼‰"
    visible="true">
    <div style="padding: 20px;">
      <h3>è¿™æ˜¯ Drawer 2 çš„å†…å®¹</h3>
      <p>âœ… è¿™ä¸ª drawer è®¾ç½®äº† visible="true"ï¼Œæ‰€ä»¥åº”è¯¥ä¸€å¼€å§‹å°±æ˜¾ç¤ºã€‚</p>
    </div>
  </ldesign-drawer>

  <!-- æµ‹è¯• 3: å¤šä¸ªæ–¹å‘ -->
  <ldesign-drawer 
    id="drawer-3" 
    placement="left" 
    drawerTitle="å·¦ä¾§æŠ½å±‰">
    <div style="padding: 20px;">
      <p>ä»å·¦ä¾§æ»‘å…¥</p>
    </div>
  </ldesign-drawer>

  <ldesign-drawer 
    id="drawer-4" 
    placement="right" 
    drawerTitle="å³ä¾§æŠ½å±‰">
    <div style="padding: 20px;">
      <p>ä»å³ä¾§æ»‘å…¥</p>
    </div>
  </ldesign-drawer>

  <ldesign-drawer 
    id="drawer-5" 
    placement="top" 
    drawerTitle="é¡¶éƒ¨æŠ½å±‰">
    <div style="padding: 20px;">
      <p>ä»é¡¶éƒ¨æ»‘å…¥</p>
    </div>
  </ldesign-drawer>

  <ldesign-drawer 
    id="drawer-6" 
    placement="bottom" 
    drawerTitle="åº•éƒ¨æŠ½å±‰">
    <div style="padding: 20px;">
      <p>ä»åº•éƒ¨æ»‘å…¥</p>
    </div>
  </ldesign-drawer>

  <script>
    // ç›‘å¬é¡µé¢åŠ è½½å®Œæˆ
    window.addEventListener('load', () => {
      console.log('ğŸ“Š é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥ drawer çŠ¶æ€...');
      console.log('='.repeat(60));
      
      // æ£€æŸ¥æ‰€æœ‰ drawer
      const drawers = document.querySelectorAll('ldesign-drawer');
      console.log(`æ‰¾åˆ° ${drawers.length} ä¸ª drawer ç»„ä»¶\n`);
      
      drawers.forEach((drawer, index) => {
        const visible = drawer.getAttribute('visible');
        const id = drawer.getAttribute('id');
        const shadowRoot = drawer.shadowRoot;
        
        console.log(`ğŸ” Drawer #${index + 1} (${id}):`);
        console.log(`  - visible å±æ€§: ${visible || 'false (default)'}`);
        console.log(`  - æ˜¯å¦æœ‰ Shadow DOM: ${!!shadowRoot}`);
        
        if (shadowRoot) {
          const container = shadowRoot.querySelector('.ldesign-drawer-container');
          const wrapper = shadowRoot.querySelector('.drawer-wrapper');
          
          console.log(`  - Shadow DOM ä¸­æ˜¯å¦æœ‰å®¹å™¨: ${!!container}`);
          console.log(`  - Shadow DOM ä¸­æ˜¯å¦æœ‰ wrapper: ${!!wrapper}`);
          
          if (container) {
            const computedStyle = window.getComputedStyle(container);
            console.log(`  - å®¹å™¨ display: ${computedStyle.display}`);
            console.log(`  - å®¹å™¨ visibility: ${computedStyle.visibility}`);
            console.log(`  - å®¹å™¨ classes: ${container.className}`);
          }
          
          if (wrapper) {
            const computedStyle = window.getComputedStyle(wrapper);
            console.log(`  - Wrapper transform: ${computedStyle.transform}`);
          }
        } else {
          // é Shadow DOM æƒ…å†µ
          const container = drawer.querySelector('.ldesign-drawer-container');
          console.log(`  - æ˜¯å¦åœ¨ Light DOM ä¸­æ¸²æŸ“: ${!!container}`);
        }
        
        console.log('');
      });

      // æ£€æŸ¥ drawer-1 æ˜¯å¦æ­£ç¡®éšè—
      setTimeout(() => {
        console.log('='.repeat(60));
        console.log('ğŸ¯ æ£€æŸ¥ Drawer-1 çš„éšè—çŠ¶æ€...');
        
        const drawer1 = document.getElementById('drawer-1');
        const shadowRoot = drawer1.shadowRoot;
        
        if (!shadowRoot) {
          console.error('âŒ Drawer 1 æ²¡æœ‰ Shadow DOMï¼');
          document.getElementById('status').style.display = 'block';
          return;
        }
        
        const container = shadowRoot.querySelector('.ldesign-drawer-container');
        
        if (!container) {
          console.log('âœ… Drawer 1 å®Œå…¨æ²¡æœ‰æ¸²æŸ“ï¼ˆæœ€ä½³æƒ…å†µï¼‰');
          const successDiv = document.createElement('div');
          successDiv.className = 'success';
          successDiv.innerHTML = '<strong>âœ… å®Œç¾ï¼</strong> Drawer åˆå§‹åŒ–æ—¶å®Œå…¨æ²¡æœ‰æ¸²æŸ“ä»»ä½• DOM å†…å®¹ã€‚';
          document.getElementById('status').parentElement.insertBefore(successDiv, document.getElementById('status'));
          return;
        }
        
        const computedStyle = window.getComputedStyle(container);
        console.log(`Drawer-1 å®¹å™¨çŠ¶æ€:`);
        console.log(`  - display: ${computedStyle.display}`);
        console.log(`  - visibility: ${computedStyle.visibility}`);
        console.log(`  - classes: ${container.className}`);
        
        if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden') {
          console.log('âœ… Drawer 1 å·²æ­£ç¡®éšè—ï¼ˆé€šè¿‡ CSSï¼‰');
        } else {
          document.getElementById('status').style.display = 'block';
          console.error('âŒ Drawer 1 should be hidden but it\'s visible!');
        }
      }, 100);
    });

    // ç›‘å¬æ‰€æœ‰ drawer äº‹ä»¶
    document.querySelectorAll('ldesign-drawer').forEach(drawer => {
      ['drawerBeforeOpen', 'drawerOpen', 'drawerBeforeClose', 'drawerClose', 'drawerStateChange'].forEach(eventName => {
        drawer.addEventListener(eventName, (e) => {
          console.log(`ğŸ“¢ ${drawer.id}: ${eventName}`, e.detail || '');
        });
      });
    });
  </script>
</body>
</html>