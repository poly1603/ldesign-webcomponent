<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avatar 修复测试</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #f5f5f5;
    }
    
    .test-section {
      background: white;
      padding: 30px;
      margin-bottom: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h2 {
      margin: 0 0 20px 0;
      color: #333;
    }
    
    .test-row {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
      padding: 15px;
      background: #fafafa;
      border-radius: 8px;
    }
    
    .label {
      min-width: 150px;
      font-weight: 600;
      color: #666;
    }
    
    .avatars {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .status {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status.pass {
      background: #d4edda;
      color: #155724;
    }
    
    .status.fail {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <h1>🔧 Avatar 组件修复测试</h1>
  
  <!-- 测试 1: 徽标位置 -->
  <div class="test-section">
    <h2>测试 1: 徽标不被裁剪</h2>
    <p style="color: #666; margin-bottom: 20px;">徽标应该完全显示，不会被父容器裁剪</p>
    
    <div class="test-row">
      <span class="label">红点徽标</span>
      <div class="avatars">
        <ldesign-avatar 
          icon="user" 
          background="#bfbfbf"
          badge="true">
        </ldesign-avatar>
        
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=1" 
          badge="true">
        </ldesign-avatar>
        
        <ldesign-avatar 
          text="U" 
          background="#fa8c16"
          badge="true">
        </ldesign-avatar>
      </div>
      <span class="status pass">✓ 应该完整显示</span>
    </div>
    
    <div class="test-row">
      <span class="label">数字徽标</span>
      <div class="avatars">
        <ldesign-avatar 
          icon="user" 
          background="#bfbfbf"
          badge-value="1">
        </ldesign-avatar>
        
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=2" 
          badge-value="99">
        </ldesign-avatar>
        
        <ldesign-avatar 
          text="V" 
          background="#722ed1"
          badge-value="999">
        </ldesign-avatar>
      </div>
      <span class="status pass">✓ 应该完整显示</span>
    </div>
    
    <div class="test-row">
      <span class="label">四个角落</span>
      <div class="avatars">
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=3" 
          badge-value="1"
          badge-position="top-right">
        </ldesign-avatar>
        
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=4" 
          badge-value="2"
          badge-position="top-left">
        </ldesign-avatar>
        
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=5" 
          badge-value="3"
          badge-position="bottom-right">
        </ldesign-avatar>
        
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=6" 
          badge-value="4"
          badge-position="bottom-left">
        </ldesign-avatar>
      </div>
      <span class="status pass">✓ 所有角落都应完整显示</span>
    </div>
  </div>
  
  <!-- 测试 2: 文字自动缩放 -->
  <div class="test-section">
    <h2>测试 2: 文字自动缩放</h2>
    <p style="color: #666; margin-bottom: 20px;">长文本应该自动缩小以适应容器，短文本保持原始大小</p>
    
    <div class="test-row">
      <span class="label">短文本（不缩放）</span>
      <div class="avatars">
        <ldesign-avatar text="U" background="#1890ff"></ldesign-avatar>
        <ldesign-avatar text="张" background="#52c41a"></ldesign-avatar>
        <ldesign-avatar text="王" background="#fa8c16"></ldesign-avatar>
      </div>
      <span class="status pass">✓ 应保持正常大小</span>
    </div>
    
    <div class="test-row">
      <span class="label">中等文本（适度缩放）</span>
      <div class="avatars">
        <ldesign-avatar text="AB" background="#722ed1"></ldesign-avatar>
        <ldesign-avatar text="张三" background="#eb2f96"></ldesign-avatar>
        <ldesign-avatar text="李四" background="#13c2c2"></ldesign-avatar>
      </div>
      <span class="status pass">✓ 应适度缩小</span>
    </div>
    
    <div class="test-row">
      <span class="label">长文本（明显缩放）</span>
      <div class="avatars">
        <ldesign-avatar text="USER" background="#1890ff"></ldesign-avatar>
        <ldesign-avatar text="ChangeUser" background="#52c41a"></ldesign-avatar>
        <ldesign-avatar text="Administrator" background="#fa8c16"></ldesign-avatar>
      </div>
      <span class="status pass">✓ 应明显缩小以完整显示</span>
    </div>
    
    <div class="test-row">
      <span class="label">不同尺寸</span>
      <div class="avatars">
        <ldesign-avatar text="Admin" background="#722ed1" size="small"></ldesign-avatar>
        <ldesign-avatar text="Admin" background="#722ed1" size="medium"></ldesign-avatar>
        <ldesign-avatar text="Admin" background="#722ed1" size="large"></ldesign-avatar>
      </div>
      <span class="status pass">✓ 各尺寸都应缩放</span>
    </div>
  </div>
  
  <!-- 测试 3: 状态指示器 -->
  <div class="test-section">
    <h2>测试 3: 状态指示器位置</h2>
    <p style="color: #666; margin-bottom: 20px;">状态点应该显示在右下角，不被裁剪</p>
    
    <div class="test-row">
      <span class="label">状态指示器</span>
      <div class="avatars">
        <ldesign-avatar src="https://i.pravatar.cc/100?img=7" status="online"></ldesign-avatar>
        <ldesign-avatar src="https://i.pravatar.cc/100?img=8" status="offline"></ldesign-avatar>
        <ldesign-avatar src="https://i.pravatar.cc/100?img=9" status="busy"></ldesign-avatar>
        <ldesign-avatar src="https://i.pravatar.cc/100?img=10" status="away"></ldesign-avatar>
      </div>
      <span class="status pass">✓ 应该完整显示</span>
    </div>
  </div>
  
  <!-- 测试 4: 组合测试 -->
  <div class="test-section">
    <h2>测试 4: 徽标 + 状态 组合</h2>
    <p style="color: #666; margin-bottom: 20px;">徽标和状态点同时显示，都不应该被裁剪</p>
    
    <div class="test-row">
      <span class="label">组合显示</span>
      <div class="avatars">
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=11" 
          badge-value="5"
          status="online">
        </ldesign-avatar>
        
        <ldesign-avatar 
          text="张三" 
          background="#52c41a"
          badge-value="99"
          status="busy">
        </ldesign-avatar>
        
        <ldesign-avatar 
          icon="user" 
          background="#fa8c16"
          badge="true"
          status="away">
        </ldesign-avatar>
      </div>
      <span class="status pass">✓ 徽标和状态都应完整显示</span>
    </div>
  </div>
  
  <!-- 测试 5: 边框测试 -->
  <div class="test-section">
    <h2>测试 5: 边框不影响布局</h2>
    <p style="color: #666; margin-bottom: 20px;">边框不应该影响头像大小和徽标位置</p>
    
    <div class="test-row">
      <span class="label">带边框 + 徽标</span>
      <div class="avatars">
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=12" 
          border="true"
          badge-value="3">
        </ldesign-avatar>
        
        <ldesign-avatar 
          src="https://i.pravatar.cc/100?img=13" 
          border="true"
          border-color="#1890ff"
          border-width="3"
          badge-value="99">
        </ldesign-avatar>
        
        <ldesign-avatar 
          text="边框" 
          background="#722ed1"
          border="true"
          border-color="#eb2f96"
          border-width="4"
          badge="true">
        </ldesign-avatar>
      </div>
      <span class="status pass">✓ 边框和徽标都应正常显示</span>
    </div>
  </div>
  
  <!-- 测试 6: Gap 测试 -->
  <div class="test-section">
    <h2>测试 6: Gap 调整</h2>
    <p style="color: #666; margin-bottom: 20px;">改变 gap 值应该影响文字与边界的距离</p>
    
    <div class="test-row">
      <span class="label">不同 gap 值</span>
      <div class="avatars">
        <ldesign-avatar text="Gap0" background="#1890ff" gap="0"></ldesign-avatar>
        <ldesign-avatar text="Gap4" background="#52c41a" gap="4"></ldesign-avatar>
        <ldesign-avatar text="Gap8" background="#fa8c16" gap="8"></ldesign-avatar>
      </div>
      <span class="status pass">✓ gap 越大留白越多</span>
    </div>
  </div>
  
  <div style="padding: 20px; background: #e6f7ff; border-radius: 8px; margin-top: 30px;">
    <h3 style="margin: 0 0 10px 0; color: #0050b3;">✅ 验证清单</h3>
    <ul style="margin: 0; padding-left: 20px; color: #0050b3;">
      <li>徽标（红点和数字）应该完全显示，不被头像边缘裁剪</li>
      <li>长文本应该自动缩小以适应头像大小</li>
      <li>状态指示器应该显示在右下角，不被裁剪</li>
      <li>徽标和状态可以同时显示，互不影响</li>
      <li>边框不应该影响头像尺寸</li>
      <li>调整 gap 应该影响文字留白</li>
    </ul>
  </div>
  
  <script type="module">
    // 如果组件已经打包，在这里引入
    // import { defineCustomElements } from '../../dist/esm/loader';
    // defineCustomElements();
    
    // 等待组件加载后测试
    setTimeout(() => {
      console.log('测试开始...');
      
      // 检查所有徽标
      const badges = document.querySelectorAll('.ldesign-avatar__badge');
      console.log(`找到 ${badges.length} 个徽标`);
      badges.forEach((badge, i) => {
        const rect = badge.getBoundingClientRect();
        console.log(`徽标 ${i + 1} 位置:`, {
          top: rect.top,
          left: rect.left,
          width: rect.width,
          height: rect.height
        });
      });
      
      // 检查所有文字缩放
      const texts = document.querySelectorAll('.ldesign-avatar__string');
      console.log(`找到 ${texts.length} 个文字头像`);
      texts.forEach((text, i) => {
        const transform = window.getComputedStyle(text).transform;
        console.log(`文字 ${i + 1} transform:`, transform);
      });
    }, 1000);
  </script>
</body>
</html>
